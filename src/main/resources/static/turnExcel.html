<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>身份证生成</title>
    <link href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-3.3.1.min.js" type="text/javascript" charset="UTF-8"></script>
    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
</head>
<style type="text/css">

</style>
<body>
<div id="div">
    <form class="form-inline">
        <div class="form-group col-md-offset-3" id="distpicker2">
            <span class="help-block"></span>
            <select id="province" class="form-control" style="width:auto;display:inline-block;">
                <option value="" data-code="">---- 所在省 ----</option>
                <option value="北京市" data-code="11" selected="">北京市</option>
                <option value="天津市" data-code="12">天津市</option>
                <option value="河北省" data-code="13">河北省</option>
                <option value="山西省" data-code="14">山西省</option>
                <option value="内蒙古自治区" data-code="15">内蒙古自治区</option>
                <option value="辽宁省" data-code="21">辽宁省</option>
                <option value="吉林省" data-code="22">吉林省</option>
                <option value="黑龙江省" data-code="23">黑龙江省</option>
                <option value="上海市" data-code="31">上海市</option>
                <option value="江苏省" data-code="32">江苏省</option>
                <option value="浙江省" data-code="33">浙江省</option>
                <option value="安徽省" data-code="34">安徽省</option>
                <option value="福建省" data-code="35">福建省</option>
                <option value="江西省" data-code="36">江西省</option>
                <option value="山东省" data-code="37">山东省</option>
                <option value="河南省" data-code="41">河南省</option>
                <option value="湖北省" data-code="42">湖北省</option>
                <option value="湖南省" data-code="43">湖南省</option>
                <option value="广东省" data-code="44">广东省</option>
                <option value="广西壮族自治区" data-code="45">广西壮族自治区</option>
                <option value="海南省" data-code="46">海南省</option>
                <option value="重庆市" data-code="50">重庆市</option>
                <option value="四川省" data-code="51">四川省</option>
                <option value="贵州省" data-code="52">贵州省</option>
                <option value="云南省" data-code="53">云南省</option>
                <option value="西藏自治区" data-code="54">西藏自治区</option>
                <option value="陕西省" data-code="61">陕西省</option>
                <option value="甘肃省" data-code="62">甘肃省</option>
                <option value="青海省" data-code="63">青海省</option>
                <option value="宁夏回族自治区" data-code="64">宁夏回族自治区</option>
                <option value="新疆维吾尔自治区" data-code="65">新疆维吾尔自治区</option>
                <option value="台湾省" data-code="71">台湾省</option>
                <option value="香港特别行政区" data-code="81">香港特别行政区</option>
                <option value="澳门特别行政区" data-code="82">澳门特别行政区</option>
            </select>

            <select id="shi" class="form-control" style="width:auto;display:inline-block;">
                <option data-code="">---- 地区编号1 ----</option>
                <option data-code="01" selected="">01</option>
                <option data-code="02">02</option>
                <option data-code="03">03</option>
                <option data-code="04">04</option>
                <option data-code="05">05</option>
                <option data-code="06">06</option>
                <option data-code="07">07</option>
                <option data-code="08">08</option>
            </select>

            <select id="qu" class="form-control" style="width:auto;display:inline-block;">
                <option data-code="">---- 地区编号2 ----</option>
                <option data-code="01" selected="">01</option>
                <option data-code="02">02</option>
                <option data-code="03">03</option>
                <option data-code="04">04</option>
                <option data-code="05">05</option>
                <option data-code="06">06</option>
                <option data-code="07">07</option>
                <option data-code="08">08</option>
                <option data-code="09">09</option>
                <option data-code="10">10</option>
                <option data-code="11">11</option>
                <option data-code="12">12</option>
                <option data-code="13">13</option>
                <option data-code="14">14</option>
            </select>

            <input id="birthday" class="form-control" type="date">

            <select id="gender" class="form-control" style="width:auto;display:inline-block;">
                <option value="" data-code="">---- 性别 ----</option>
                <option value="1" selected="">男</option>
                <option value="2">女</option>
            </select>
            <span class="help-block"></span>
        </div>
<!--    <input id="url" type="text"/>-->
<!--    <input type="button" onclick="spider()" value="爬"><br/>-->

        <div class="form-group col-md-offset-3">
            <label class="col-sm-4 control-label">生成个数：</label>
            <div class="col-sm-1">
                <input id="num" value="10" class="form-control" type="text"/>
                <span class="help-block"></span>
            </div>
        </div>
        <div class="form-group">
            <input type="button" onclick="spiderIdCard()" class="btn btn-default" value="生成身份证号码">
            <input type="button" id="outPort" class="btn btn-default" value="导出">
            <input type="button" id="oneKey" class="btn btn-default" value="一键生成导出">
            <span class="help-block"></span>
        </div>
    </form>
</div>
<!--<input id="turn" type="text"  />-->
<!--<input type="button" id="turnTr" value="转化">-->
<!--<input type="button" id="outPort" value="导出">-->
<!--<input type="button" id="oneKey" value="一键转化导出">-->
<!--<input type="button" id="idCardWeb" value="身份证号码生成网站"><br/>-->

<!--<input id="num" type="text">-->
<!--<input type="button" id="oneKeyCreate" value="一键生成">-->
<!--<input type="button" id="outPort1" value="导出">-->
<!--<input type="button" id="totallyout" value="一键生成导出">-->

<!--<a href="http://sfz.uzuzuz.com/?region=110101&birthday=19030307&sex=1&num=5" target="_blank">身份证号码生成网站</a>-->
<div class="row">
    <div style="text-align:center" class="col-md-2 col-md-offset-5">
        <table style="margin:0px auto" class="table table-hover" border="1" id="table">
            <!--    <tbody>-->
            <!--    <tr align="center" th:each="map:${maps}">-->
            <!--        <td th:value="${map.value}">[[${map.value}]]</td>-->
            <!--    </tr>-->
            <!--    </tbody>-->
        </table>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>


    $(function(){
        var time = new Date()
        var day = ('0' + time.getDate()).slice(-2)
        var month = ('0' + (time.getMonth() + 1)).slice(-2)
        var date = 1990 + '-' + month + '-' + day
        $('#birthday').val(date)
    })


    function spider() {
        window.open("localhost:8888/spiderDemo/getHospitalInfo?url=" + $("#url").val() + "&encoding=utf-8");
    }

    function spiderIdCard() {
        var region = $("#province option:selected").attr("data-code") + "" + $("#shi option:selected").attr("data-code") + "" + $("#qu option:selected").attr("data-code");
        var birthday = $('#birthday').val();
        birthday = birthday.replace(/-/g, "");
        var gender = $("#gender option:selected").val()
        var num = $("#num").val()
        var url = "http://sfz.uzuzuz.com/?region=" + region + "&birthday=" + birthday + "&sex=" + gender + "&num=" + num + "r=" + Math.floor(Math.random() * 100 + 1);
        $.ajax({
            async: false,
            type: "post",
            url: "/spiderDemo/getIdCardInfo",
            data: {"url": url, "encoding": "utf-8"},
            dataType: "json",
            success: function (result) {
                $("#table").empty()
                $.each(result, function (index, ele) {
                    var tr = $("<tr></tr>")
                    var td = "<td style=" + "mso-number-format:'\\@';" +  "value=" + ele + ">" + ele + "</td>"
                    tr.append(td);
                    $("#table").append(tr)
                })

            }
        })

        //window.open("localhost:8888/spiderDemo/getIdCardInfo?url=https://sfz.uzuzuz.com/?region=" + region + "&birthday=19430307&sex=1&num=1000" + "&encoding=utf-8");
    }


    function turn(cont) {
        var text = cont.replace(/\s+/g,"");
        var size = Math.round(text.length/18);
        var strs= new Array();
        var j = 0
        for (i = 0; i < size; i++){
            var val = text.substring(j, j+18)
            strs.push(val)
            j += 18;
        }
        $("#table").empty();
        $.each(strs, function (index, ele) {
            var tr = $("<tr></tr>")
            tr.append("<td width='165' style=\"mso-number-format:'\\@';\">" + ele + "</td>")
            $("#table").append(tr)
        })
    }


    $("#turnTr").click(function () {
        turn($("#turn").val());
    })

    $("#outPort").click(function () {
        tableToExcel("table", "test");
    })

    $("#outPort1").click(function () {
        tableToExcel("table", "test");
    })

    $("#oneKey").click(function () {
        //turn($("#turn").val());
        spiderIdCard()
        tableToExcel("table", "test");
    })

    $("#oneKeyCreate").click(function () {
        createIdCard($("#num").val())
    })

    $("#totallyout").click(function () {
        createIdCard($("#num").val())
        tableToExcel("table", "test");
    })


    // var num = 1600;
    // var sss = [2283,2274,2268,2265,2263,2231,2199,2197,2194,2193,2188,2184]
    // var ss = 0
    // $("#show5").click(function(){
    //     window.open("http://180.100.74.63:6001/research/getMeshPaths?pdid="+num);
    //     ss++
    //     num--;
    // });

    function base64(content) {
        return window.btoa(unescape(encodeURIComponent(content)));
    }

    /**
     * 导出功能
     * @param tableID
     * @param fileName
     */
    function tableToExcel(tableID, fileName) {
        var excelContent = $("#" + tableID).html();
        // 		alert(excelContent);
        var excelFile = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";
        excelFile += "<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head>";
        excelFile += "<body><div style='text-align: center;'><table style='margin:0 auto;' width='10%' border='1'>";
        excelFile += excelContent;
        excelFile += "</table></div></body>";
        excelFile += "</html>";
        var newExcelFile = excelFile.replace(/td/g, "th");
        var link = "data:application/vnd.ms-excel;base64," + base64(newExcelFile);
        var a = document.createElement("a");
        a.download = fileName + ".xls";
        a.href = link;
        a.click();
    }
    $("#idCardWeb").click(function () {
        window.open("http://sfz.uzuzuz.com/?region=110101&birthday=19030307&sex=1&num=5");
    })


    // 生成随机数字，max限制最大值，base限制最小值
    function getRandom(max, base) {
        return Math.floor(Math.random() * max + (base ? base : 0));
    }

    // 根据前17位生成末位
    function cnNewID(idcard) {
        var arrExp = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]; // 加权因子
        var arrValid = [1, 0, "X", 9, 8, 7, 6, 5, 4, 3, 2]; // 校验码
        var sum = 0, idx;
        for (var j = 0; j < 17; j++) {
            // 对前17位数字与权值乘积求和
            sum += parseInt(idcard[j], 10) * arrExp[j];
        }
        return arrValid[sum % 11];
    }

    function first() {
        var arrExp = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2]; // 加权因子
        var area = [11, 12, 13, 14, 15, 21, 22, 23, 31, 32, 33, 34, 35, 36, 37, 41, 42, 43, 44, 45, 46, 50, 51, 52, 53, 54, 61, 62, 63, 64, 65, 71, 81, 82, 91
        ];
        // var sum = 0, idx;
        // for (var j = 0; j < 17; j++) {
        //     // 对前17位数字与权值乘积求和
        //     sum += parseInt(idcard[j], 10) * arrExp[j];
        // }
        return area[getRandom(35)];
    }




    // 生成身份证号
    function getIdcard() {
        var idcard = '';
        for(var i = 0; i < 18; i++) {
            if(i < 6) {
                idcard += getRandom(10)
            }else if(i == 6) {
                idcard += getRandom(2, 1) //年份第一位仅支持1和2
            }else if(i == 7) {
                idcard += idcard[6] == '1' ? 9 : 0;//两位年份规则，仅支持19和20
            }else if(i == 8) {
                idcard += idcard[6] == '1' ? getRandom(7, 3) : getRandom(2); //三位年份规则，仅支持193-199、200、201这些值
            }else if(i == 9) {
                idcard += getRandom(10) //四位年份规则,0-9
            }else if(i == 10) {
                idcard += getRandom(2);//首位月份规则
            }else if(i == 11) {
                idcard += idcard[10] == '0' ? getRandom(9, 1) : getRandom(3);//末位月份规则
            }else if(i == 12) {
                if(idcard.substr(8, 2) % 4 != 0) {//首位日期规则，闰年没有30几号
                    idcard += getRandom(4, 0);
                }else {
                    idcard += getRandom(3, 0);
                }
            }else if(i == 13) {
                if(idcard[12] == 0) {//末位日期规则
                    idcard += getRandom(9, 1);
                }else if(idcard[12] > 0 && idcard[12] < 3) {
                    if(idcard.substr(8, 2) % 4 != 0 && idcard.substr(10, 2) == '02') { // 判断闰年2月没有29号
                        idcard += getRandom(9, 1);
                    }else {
                        idcard += getRandom(10);
                    }
                }else {

                    idcard += getRandom(2);
                }
            }else if(i > 13 && i < 17) {
                idcard += getRandom(10)
            }else if(i == 17) {
                idcard += cnNewID(idcard);
            }
        }

        idcard = first() + idcard.substring(2);


        //return idcard;
        if (checkCardId(idcard)) {
            return idcard;
        } else {
            getIdcard();
        }
    }

    function checkCardId(socialNo) {
        if (socialNo == "") {
            // alert("输入身份证号码不能为空!");
            return false;
        }
        if (socialNo.length != 15 && socialNo.length != 18) {
            // alert("输入身份证号码格式不正确!");
            return false;
        }

        var area = {
            11: "北京",
            12: "天津",
            13: "河北",
            14: "山西",
            15: "内蒙古",
            21: "辽宁",
            22: "吉林",
            23: "黑龙江",
            31: "上海",
            32: "江苏",
            33: "浙江",
            34: "安徽",
            35: "福建",
            36: "江西",
            37: "山东",
            41: "河南",
            42: "湖北",
            43: "湖南",
            44: "广东",
            45: "广西",
            46: "海南",
            50: "重庆",
            51: "四川",
            52: "贵州",
            53: "云南",
            54: "西藏",
            61: "陕西",
            62: "甘肃",
            63: "青海",
            64: "宁夏",
            65: "新疆",
            71: "台湾",
            81: "香港",
            82: "澳门",
            91: "国外"
        };

        if (area[parseInt(socialNo.substr(0, 2))] == null) {
            // alert("身份证号码不正确(地区非法)!");
            return false;
        }

        if (socialNo.length == 15) {
            pattern = /^\d{15}$/;
            if (pattern.exec(socialNo) == null) {
                // alert("15位身份证号码必须为数字！");
                return false;
            }
            var birth = parseInt("19" + socialNo.substr(6, 2));
            var month = socialNo.substr(8, 2);
            var day = parseInt(socialNo.substr(10, 2));
            switch (month) {
                case '01':
                case '03':
                case '05':
                case '07':
                case '08':
                case '10':
                case '12':
                    if (day > 31) {
                        // alert('输入身份证号码不格式正确!');
                        return false;
                    }
                    break;
                case '04':
                case '06':
                case '09':
                case '11':
                    if (day > 30) {
                        // alert('输入身份证号码不格式正确!');
                        return false;
                    }
                    break;
                case '02':
                    if ((birth % 4 == 0 && birth % 100 != 0) || birth % 400 == 0) {
                        if (day > 29) {
                            // alert('输入身份证号码不格式正确!');
                            return false;
                        }
                    } else {
                        if (day > 28) {
                            // alert('输入身份证号码不格式正确!');
                            return false;
                        }
                    }
                    break;
                default:
                    // alert('输入身份证号码不格式正确!');
                    return false;
            }
            var nowYear = new Date().getYear();
            if (nowYear - parseInt(birth) < 15 || nowYear - parseInt(birth) > 100) {
                // alert('输入身份证号码不格式正确!');
                return false;
            }
            return true;
        }

        var Wi = new Array(
            7, 9, 10, 5, 8, 4, 2, 1, 6,
            3, 7, 9, 10, 5, 8, 4, 2, 1
        );
        var lSum = 0;
        var nNum = 0;
        var nCheckSum = 0;

        for (i = 0; i < 17; ++i) {
            if (socialNo.charAt(i) < '0' || socialNo.charAt(i) > '9') {
                // alert("输入身份证号码格式不正确!");
                return false;
            } else {
                nNum = socialNo.charAt(i) - '0';
                return true;
            }
            lSum += nNum * Wi[i];
        }


        if (socialNo.charAt(17) == 'X' || socialNo.charAt(17) == 'x') {
            lSum += 10 * Wi[17];
        } else if (socialNo.charAt(17) < '0' || socialNo.charAt(17) > '9') {
            // alert("输入身份证号码格式不正确!");
            return false;
        } else {
            lSum += (socialNo.charAt(17) - '0') * Wi[17];
        }


        if ((lSum % 11) == 1) {
            return true;
        } else {
            // alert("输入身份证号码格式不正确!");
            return false;
        }
    }




    function createIdCard(num) {
        var text = ""
        for (var i = 0; i < num; i++) {
            text += getIdcard();
        }
        turn(text);
    }





</script>
</body>
</html>